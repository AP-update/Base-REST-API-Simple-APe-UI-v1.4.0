<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> APe UI Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }

        h1, h2, h3, .method-get, .method-post, .btn-try, .btn-execute {
            font-family: 'Space Grotesk', sans-serif;
        }
        
        #page-loader {
            position: fixed;
            inset: 0;
            background: #0f172a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loader-ring {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(73, 204, 144, 0.1);
            border-top: 4px solid #49cc90;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .btn-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .category-content.active {
            max-height: 5000px;
        }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .glass-nav {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
        }

        .api-card-get {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: rgba(73, 204, 144, 0.05);
            border: 1px solid #49cc90;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .api-card-get:hover { background: rgba(73, 204, 144, 0.1); border-color: #3eaf7c; transform: translateY(-1px); }

        .method-get {
            background-color: #49cc90;
            color: white;
            font-weight: 800;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 10px;
            min-width: 55px;
            text-align: center;
        }

        .method-post {
            background-color: #fbbf24;
            color: white;
            font-weight: 800;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 10px;
            min-width: 55px;
            text-align: center;
        }

        .btn-try {
            font-size: 10px;
            font-weight: 800;
            color: #49cc90;
            padding: 4px 12px;
            border: 1px solid #49cc90;
            border-radius: 6px;
            background: white;
            transition: all 0.2s;
        }
        .api-card-get:hover .btn-try {
            background: #49cc90;
            color: white;
        }

        .response-container {
            background: #0f172a;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #334155;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
        .response-header {
            background: #1e293b;
            padding: 10px 16px;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .response-body {
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden; 
            font-family: 'Fira Code', 'Cascadia Code', monospace;
            font-size: 11px;
            line-height: 1.6;
            background: #0f172a;
        }
        .response-body pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #49cc90;
        }

        #toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            animation: slideInTop 0.3s ease-out forwards;
            min-width: 250px;
        }
        @keyframes slideInTop {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 640px) {
            .api-card-get { gap: 8px; padding: 8px; }
            .method-get, .method-post { min-width: 45px; font-size: 9px; }
            .api-name { font-size: 11px !important; }
            .btn-try { padding: 3px 8px; font-size: 9px; }
        }
    </style>
</head>
<body class="text-slate-800">

    <div id="page-loader">
        <div class="loader-ring"></div>
        <p class="text-white mt-4 font-bold tracking-[0.2em] text-[10px] animate-pulse uppercase">LOADING...</p>
    </div>

    <div id="toast-container"></div>

    <nav class="glass-nav border-b border-slate-700 p-4 sticky top-0 z-50 shadow-xl">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div id="profile-container" class="hidden">
                    <img id="owner-img" src="" alt="Owner" class="w-9 h-9 rounded-full border-2 border-[#49cc90] object-cover shadow-lg">
                </div>
                <div id="default-logo" class="w-8 h-8 bg-[#49cc90] rounded flex items-center justify-center text-white shadow-md shadow-[#49cc90]/20">
                    <i class="fa-solid fa-bolt text-sm"></i>
                </div>
                <h1 id="brand" class="text-lg font-bold text-white tracking-tight">APe UI</h1>
            </div>
            <div id="api-type-badge" class="text-[9px] text-[#49cc90] font-black border border-[#49cc90]/30 px-2 py-1 rounded uppercase tracking-tighter">Loading...</div>
        </div>
    </nav>

    <div class="bg-white/70 backdrop-blur-md border-b border-slate-200">
        <div class="max-w-5xl mx-auto px-6 py-10">
            <h2 class="text-3xl font-extrabold text-slate-900 mb-2 tracking-tight">API Documentation</h2>
            <p id="description-header" class="text-slate-500 text-sm max-w-2xl leading-relaxed">Memuat deskripsi...</p>
            
            <div class="mt-4 flex flex-wrap items-center gap-x-6 gap-y-2">
                <div class="flex items-center gap-2">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Base URL:</span>
                    <span id="base-url-text" class="text-[11px] font-mono font-bold text-indigo-600 tracking-tight"></span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Status:</span>
                    <div class="flex items-center gap-1.5">
                        <div class="w-2 h-2 bg-[#49cc90] rounded-full animate-pulse shadow-[0_0_8px_#49cc90]"></div>
                        <span class="text-[11px] font-bold text-slate-600 uppercase tracking-tight">Online</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main class="max-w-5xl mx-auto p-4 md:p-8">
        <div class="relative mb-8 group">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-[#49cc90]">
                <i class="fa-solid fa-magnifying-glass text-xs"></i>
            </div>
            <input type="text" id="search-api" onkeyup="filterAPI()" placeholder="Cari endpoint (nama, path, atau deskripsi)..." class="w-full bg-white border border-slate-300 rounded-xl py-3.5 pl-11 pr-4 text-sm focus:border-[#49cc90] focus:ring-4 focus:ring-[#49cc90]/5 outline-none shadow-sm transition-all">
        </div>

        <div id="app-content">
            <div class="text-center py-20 text-slate-400 font-medium text-sm">
                <i class="fa-solid fa-circle-notch fa-spin mb-3 text-2xl text-[#49cc90]"></i>
                <p>Sinkronisasi data...</p>
            </div>
        </div>
    </main>

    <footer class="max-w-7xl mx-auto p-12 mt-10 border-t border-slate-200 text-center">
        <p id="settings-footer" class="text-slate-400 text-[10px] font-medium uppercase tracking-[0.2em]"></p>
    </footer>

    <div id="modal" class="fixed inset-0 bg-slate-900/60 hidden flex items-center justify-center p-4 z-[100] backdrop-blur-sm transition-all">
        <div class="bg-white rounded-2xl w-full max-w-2xl overflow-hidden shadow-2xl flex flex-col max-h-[90vh] border border-slate-200">
            <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-[#49cc90]/5">
                <div class="flex items-center gap-3">
                    <span id="m-badge" class="method-get">GET</span>
                    <h2 id="m-name" class="font-bold text-slate-800 text-sm md:text-base leading-tight"></h2>
                </div>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full hover:bg-red-50 hover:text-red-500 text-slate-400 transition-all flex items-center justify-center">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>
            
            <div class="p-5 space-y-4 overflow-y-auto flex-1 custom-scroll">
                <div id="m-note-container"></div>
                
                <div class="space-y-2">
                    <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Request URL</label>
                    <div class="flex gap-1">
                        <input type="text" id="m-url" readonly class="w-full bg-slate-100 border border-slate-200 rounded-lg px-3 py-2.5 text-[10px] font-mono text-slate-600 outline-none">
                        <button id="copy-btn" onclick="copyURL()" class="bg-white text-slate-600 border border-slate-200 px-4 rounded-lg hover:bg-[#49cc90] hover:text-white hover:border-[#49cc90] transition-all flex items-center justify-center">
                            <i id="copy-icon" class="fa-regular fa-copy"></i>
                        </button>
                    </div>
                </div>

                <div id="m-inputs" class="grid grid-cols-1 gap-4"></div>

                <div class="mt-6">
                    <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Code Examples</label>
                    <div class="mt-2 bg-[#0f172a] rounded-xl overflow-hidden border border-slate-700 shadow-inner">
                        <div class="flex border-b border-slate-800 bg-slate-900/50">
                            <button onclick="switchTab('curl')" id="tab-curl" class="tab-btn px-4 py-2.5 text-[10px] font-black tracking-widest transition-all">CURL</button>
                            <button onclick="switchTab('js')" id="tab-js" class="tab-btn px-4 py-2.5 text-[10px] font-black tracking-widest transition-all">JAVASCRIPT</button>
                            <button onclick="switchTab('python')" id="tab-python" class="tab-btn px-4 py-2.5 text-[10px] font-black tracking-widest transition-all">PYTHON</button>
                            <div class="flex-1"></div>
                            <button onclick="copySnippet()" class="px-4 text-slate-500 hover:text-[#49cc90] transition-colors">
                                <i id="snippet-copy-icon" class="fa-regular fa-paste text-xs"></i>
                            </button>
                        </div>
                        <div class="p-4">
                            <pre id="code-snippet" class="text-[#49cc90] font-mono text-[10px] whitespace-pre-wrap break-all leading-relaxed"></pre>
                        </div>
                    </div>
                </div>

                <div id="m-result" class="hidden space-y-2">
                    <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Server Response</label>
                    <div class="response-container">
                        <div class="response-header">
                            <div id="m-stats" class="text-[10px] font-bold text-white flex gap-3"></div>
                            <div class="flex gap-3">
                                <button onclick="copyRawResponse()" title="Copy JSON" class="text-slate-400 hover:text-white transition-colors">
                                    <i class="fa-regular fa-clone text-[12px]"></i>
                                </button>
                                <button onclick="downloadResponse()" title="Download Response" class="text-slate-400 hover:text-white transition-colors">
                                    <i class="fa-solid fa-download text-[12px]"></i>
                                </button>
                            </div>
                        </div>
                        <div id="res-content" class="response-body custom-scroll">
                            </div>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                <button onclick="closeModal()" class="px-5 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider">Tutup</button>
                <button id="run-btn" class="btn-execute bg-[#49cc90] text-white px-10 py-2.5 rounded-lg text-xs font-black hover:bg-[#3eaf7c] transition-all uppercase tracking-widest shadow-lg shadow-[#49cc90]/20 flex items-center justify-center min-w-[140px]">Execute</button>
            </div>
        </div>
    </div>

    <script>
        let config = {};
        let currentPath = "", currentParams = [], currentAuth = false, currentMethod = "GET";
        let activeTab = 'curl';
        let lastResponseData = null;
        let lastResponseType = 'json';
        let lastImageObjectURL = null;

        function showToast(msg, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const colorClass = type === 'success' ? 'bg-[#49cc90]' : 'bg-red-500';
            const iconClass = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle';
            
            toast.className = `toast ${colorClass} text-white px-5 py-3 rounded-xl shadow-lg flex items-center gap-3`;
            toast.innerHTML = `<i class="fa-solid ${iconClass}"></i><span class="text-xs font-bold tracking-wide">${msg}</span>`;
            
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        async function start() {
            document.getElementById('base-url-text').innerText = window.location.origin;
            try {
                const res = await fetch('/api/docs-data');
                config = await res.json();
                
                const settings = config.settings || {};

                document.getElementById('brand').innerText = settings.api_name || 'APe UI';
                document.getElementById('api-type-badge').innerText = settings.api_type || 'REST API';
                document.getElementById('description-header').innerText = settings.description || 'Eksplorasi layanan API kami.';
                document.getElementById('settings-footer').innerHTML = `Powered by <span class="text-[#49cc90] font-bold">${settings.owner || 'Admin'}</span> | ${settings.footer || ''}`;

                if (settings.use_profile && settings.owner_profile) {
                    const profileImg = document.getElementById('owner-img');
                    const profileCont = document.getElementById('profile-container');
                    const defaultLogo = document.getElementById('default-logo');
                    profileImg.src = settings.owner_profile;
                    profileCont.classList.remove('hidden');
                    defaultLogo.classList.add('hidden');
                }

                render();
                
                setTimeout(() => {
                    const loader = document.getElementById('page-loader');
                    loader.style.opacity = '0';
                    setTimeout(() => loader.style.display = 'none', 500);
                }, 1000);
            } catch (e) {
                console.error("Fetch Error:", e);
                document.getElementById('app-content').innerHTML = `<p class="text-center text-red-500 py-20 font-bold">Gagal sinkronisasi data server.</p>`;
                document.getElementById('page-loader').style.display = 'none';
            }
        }

        function updateToggleUI(categoryId, isOpen) {
            const content = document.getElementById(`content-${categoryId}`);
            const btn = document.getElementById(`btn-toggle-${categoryId}`);
            const icon = document.getElementById(`icon-${categoryId}`);
            if (isOpen) {
                content.classList.add('active');
                btn.innerText = 'CLOSE';
                icon.classList.replace('fa-folder', 'fa-folder-open');
                icon.parentElement.classList.add('text-[#49cc90]', 'border-[#49cc90]/30');
            } else {
                content.classList.remove('active');
                btn.innerText = 'OPEN';
                icon.classList.replace('fa-folder-open', 'fa-folder');
                icon.parentElement.classList.remove('text-[#49cc90]', 'border-[#49cc90]/30');
            }
        }

        function toggleCategory(categoryId) {
            const content = document.getElementById(`content-${categoryId}`);
            const isOpen = !content.classList.contains('active');
            updateToggleUI(categoryId, isOpen);
        }

        function render() {
            const container = document.getElementById('app-content');
            container.innerHTML = "";
            Object.keys(config.endpoints).forEach((category, idx) => {
                const categoryId = `cat-${idx}`;
                let html = `
                    <div class="mb-4 bg-white rounded-2xl overflow-hidden shadow-sm border border-slate-200 category-wrapper" id="wrapper-${categoryId}">
                        <div onclick="toggleCategory('${categoryId}')" class="p-4 flex justify-between items-center cursor-pointer hover:bg-slate-50 select-none">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 bg-slate-50 text-slate-400 rounded-xl flex items-center justify-center text-sm border border-slate-100 transition-all">
                                    <i id="icon-${categoryId}" class="fa-solid fa-folder"></i>
                                </div>
                                <div>
                                    <h2 class="text-[13px] font-extrabold text-slate-700 capitalize tracking-wide">${category}</h2>
                                    <p class="text-[9px] text-[#49cc90] font-bold uppercase">${config.endpoints[category].length} Endpoints</p>
                                </div>
                            </div>
                            <span id="btn-toggle-${categoryId}" class="text-[10px] font-extrabold text-[#64748b] border border-slate-200 px-3 py-1.5 rounded-lg bg-white shadow-sm hover:bg-slate-50 transition-all uppercase tracking-tighter">OPEN</span>
                        </div>
                        <div id="content-${categoryId}" class="category-content">
                            <div class="p-4 space-y-3 bg-slate-50/40">
                `;
                config.endpoints[category].forEach(ep => {
                    const isOnline = ep.status === 'online';
                    const statusColor = isOnline ? 'text-green-500' : (ep.status === 'maintenance' ? 'text-orange-500' : 'text-red-500');
                    const searchTerms = `${ep.name} ${ep.path} ${ep.desc}`.toLowerCase();
                    const methodClass = ep.method === 'POST' ? 'method-post' : 'method-get';
                    
                    html += `
                        <div class="api-card-get group cursor-pointer ${!isOnline ? 'opacity-60 grayscale-[0.5]' : ''}" 
                             onclick="${isOnline ? `openTry('${category}', '${ep.name}')` : "showToast('Endpoint sedang offline', 'error')"}" 
                             data-search="${searchTerms}">
                            <span class="${methodClass}">${ep.method || 'GET'}</span>
                            <div class="flex-1 min-w-0">
                                <h3 class="api-name font-mono font-bold text-slate-800 text-[13px] truncate">
                                    ${ep.path.split('?')[0]} ${ep.auth ? '<i class="fa-solid fa-lock text-amber-500 text-[10px] ml-1"></i>' : ''}
                                </h3>
                                <div class="flex items-center gap-2">
                                    <p class="text-[10px] text-slate-400 truncate mt-0.5 font-medium">${ep.desc}</p>
                                    <span class="text-[9px] font-black uppercase ${statusColor}">${ep.status}</span>
                                </div>
                            </div>
                            <span class="btn-try">${isOnline ? 'TRY' : 'OFF'}</span>
                        </div>`;
                });
                container.innerHTML += html + `</div></div></div>`;
            });
        }

        function filterAPI() {
            const val = document.getElementById('search-api').value.toLowerCase().trim();
            const wrappers = document.querySelectorAll('.category-wrapper');
            wrappers.forEach(wrapper => {
                const categoryId = wrapper.id.replace('wrapper-', '');
                const cards = wrapper.querySelectorAll('.api-card-get');
                let hasMatch = false;
                cards.forEach(card => {
                    const searchData = card.getAttribute('data-search') || "";
                    if (searchData.includes(val)) {
                        card.style.display = "flex";
                        hasMatch = true;
                    } else {
                        card.style.display = "none";
                    }
                });
                if (val !== "" && hasMatch) {
                    wrapper.style.display = "block";
                    updateToggleUI(categoryId, true);
                } else if (val === "") {
                    wrapper.style.display = "block";
                    updateToggleUI(categoryId, false);
                } else {
                    wrapper.style.display = "none";
                }
            });
        }

        async function copyURL() {
            const urlInput = document.getElementById('m-url');
            const icon = document.getElementById('copy-icon');
            try {
                await navigator.clipboard.writeText(urlInput.value);
                icon.className = "fa-solid fa-check";
                showToast("URL Endpoint disalin!");
                setTimeout(() => icon.className = "fa-regular fa-copy", 2000);
            } catch (err) { showToast("Gagal menyalin URL", "error"); }
        }

        function switchTab(tab) {
            activeTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('text-[#49cc90]', 'border-b-2', 'border-[#49cc90]', 'bg-white/5');
                btn.classList.add('text-slate-500');
            });
            const activeBtn = document.getElementById(`tab-${tab}`);
            activeBtn.classList.add('text-[#49cc90]', 'border-b-2', 'border-[#49cc90]', 'bg-white/5');
            activeBtn.classList.remove('text-slate-500');
            generateSnippet();
        }

        function generateSnippet() {
            const url = document.getElementById('m-url').value;
            const pre = document.getElementById('code-snippet');
            const method = currentMethod;
            const payload = {};
            if(currentAuth) payload.apikey = "YOUR_API_KEY";
            currentParams.forEach(p => {
                const val = document.getElementById(`in-${p.name}`)?.value || "value";
                payload[p.name] = val;
            });

            if (activeTab === 'curl') {
                if(method === 'POST') pre.innerText = `curl -X POST "${url}" \\\n     -H "Content-Type: application/json" \\\n     -d '${JSON.stringify(payload)}'`;
                else pre.innerText = `curl -X GET "${url}"`;
            } else if (activeTab === 'js') {
                if(method === 'POST') pre.innerText = `fetch("${url}", {\n  method: "POST",\n  headers: { "Content-Type": "application/json" },\n  body: JSON.stringify(${JSON.stringify(payload, null, 2)})\n})\n.then(res => res.json())\n.then(console.log);`;
                else pre.innerText = `fetch("${url}")\n  .then(res => res.json())\n  .then(data => console.log(data));`;
            } else if (activeTab === 'python') {
                if(method === 'POST') pre.innerText = `import requests\n\nurl = "${url}"\npayload = ${JSON.stringify(payload, null, 4)}\nresponse = requests.post(url, json=payload)\nprint(response.json())`;
                else pre.innerText = `import requests\n\nurl = "${url}"\nresponse = requests.get(url)\nprint(response.json())`;
            }
        }

        async function copySnippet() {
            const text = document.getElementById('code-snippet').innerText;
            const icon = document.getElementById('snippet-copy-icon');
            try {
                await navigator.clipboard.writeText(text);
                icon.className = "fa-solid fa-check text-[#49cc90]";
                showToast("Snippet berhasil disalin!");
                setTimeout(() => icon.className = "fa-regular fa-paste text-xs", 2000);
            } catch (e) { showToast("Gagal menyalin snippet", "error"); }
        }

        async function copyRawResponse() {
            if(!lastResponseData && !lastImageObjectURL) return;
            try {
                const textToCopy = lastResponseType === 'image' ? lastImageObjectURL : JSON.stringify(lastResponseData, null, 2);
                await navigator.clipboard.writeText(textToCopy);
                showToast("Data disalin ke clipboard!");
            } catch(e) { showToast("Gagal menyalin", "error"); }
        }

        function downloadResponse() {
            if (lastResponseType === 'image' && lastImageObjectURL) {
                const a = document.createElement("a");
                a.href = lastImageObjectURL;
                a.download = `api_result_${Date.now()}.png`;
                a.click();
                showToast("Gambar berhasil diunduh!");
            } else if (lastResponseData) {
                const blob = new Blob([JSON.stringify(lastResponseData, null, 2)], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `response_${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showToast("File JSON berhasil diunduh!");
            }
        }

        function openTry(category, name) {
            const ep = config.endpoints[category].find(x => x.name === name);
            currentPath = ep.path.split('?')[0];
            currentAuth = ep.auth;
            currentMethod = ep.method || "GET";
            currentParams = ep.params || [];
            
            lastResponseData = null;
            lastResponseType = 'json';
            lastImageObjectURL = null;

            document.getElementById('modal').classList.remove('hidden');
            const badge = document.getElementById('m-badge');
            badge.innerText = currentMethod;
            badge.className = currentMethod === 'POST' ? 'method-post' : 'method-get';
            
            document.getElementById('m-name').innerHTML = `<div class="flex flex-col"><span class="text-slate-800">${ep.name}</span><span class="text-[10px] font-medium text-slate-500 italic">(${ep.desc})</span></div>`;
            document.getElementById('m-result').classList.add('hidden');
            document.getElementById('m-stats').innerHTML = "";
            
            const noteContainer = document.getElementById('m-note-container');
            noteContainer.innerHTML = ep.note ? `<div class="p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400"><p class="text-[11px] text-blue-700 font-medium">${ep.note}</p></div>` : "";

            const inputContainer = document.getElementById('m-inputs');
            inputContainer.innerHTML = `<p class="text-[10px] font-bold text-slate-500 border-b border-slate-100 pb-2 mb-2 uppercase tracking-widest">Parameters</p>`;
            
            if(ep.auth) {
                inputContainer.innerHTML += `
                    <div class="space-y-1.5 mb-4 group">
                        <div class="flex items-center">
                            <label class="text-[10px] font-mono font-bold text-amber-600 uppercase">apikey</label>
                            <span class="bg-amber-100 text-amber-600 text-[9px] px-1.5 py-0.5 rounded-md border border-amber-200 ml-2 flex items-center gap-1">
                                <i class="fa-solid fa-key text-[8px]"></i> WAJIB
                            </span>
                        </div>
                        <input type="text" id="in-apikey" data-required="true" oninput="updateURL()" placeholder="Masukkan apikey..." 
                        class="param-input w-full bg-white border border-slate-200 rounded-lg px-4 py-2.5 text-xs outline-none transition-all focus:border-amber-400 focus:ring-2 focus:ring-amber-100">
                    </div>`;
            }

            currentParams.forEach(p => {
                const isReq = p.required !== false;
                const pText = p.placeholder || "Isi parameter...";
                
                const badgeHtml = isReq 
                    ? `<span class="bg-red-100 text-red-600 text-[9px] px-1.5 py-0.5 rounded-md border border-red-200 ml-2">WAJIB</span>`
                    : `<span class="bg-slate-100 text-slate-500 text-[9px] px-1.5 py-0.5 rounded-md border border-slate-200 ml-2">OPSIONAL</span>`;

                inputContainer.innerHTML += `
                    <div class="space-y-1.5 group">
                        <div class="flex items-center">
                            <label class="text-[10px] font-mono font-bold text-slate-600 uppercase tracking-tighter">
                                ${p.name}
                            </label>
                            ${badgeHtml}
                        </div>
                        <div class="relative">
                            <input type="text" 
                                   id="in-${p.name}" 
                                   data-name="${p.name}" 
                                   data-required="${isReq}" 
                                   oninput="updateURL()" 
                                   placeholder="${pText}" 
                                   class="param-input w-full bg-white border border-slate-200 rounded-lg px-4 py-2.5 text-xs outline-none transition-all focus:border-[#49cc90] focus:ring-2 focus:ring-[#49cc90]/10 placeholder:text-slate-300">
                            <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none opacity-0 group-focus-within:opacity-100 transition-opacity">
                                <i class="fa-solid fa-pen-to-square text-[10px] text-[#49cc90]"></i>
                            </div>
                        </div>
                    </div>`;
            });
            
            updateURL();
            switchTab('curl');

            document.getElementById('run-btn').onclick = async () => {
                const btn = document.getElementById('run-btn');
                const resDiv = document.getElementById('res-content');
                const resContainer = document.getElementById('m-result');
                const statsDiv = document.getElementById('m-stats');

                let missing = [];
                document.querySelectorAll('.param-input').forEach(inp => {
                    const isRequired = inp.getAttribute('data-required') === "true";
                    if(isRequired && !inp.value.trim()) {
                        missing.push(inp.id.replace('in-', ''));
                        inp.classList.add('border-red-500', 'bg-red-50');
                    } else {
                        inp.classList.remove('border-red-500', 'bg-red-50');
                    }
                });

                if(missing.length > 0) { showToast(`Isi parameter wajib: ${missing.join(', ')}`, "error"); return; }

                btn.disabled = true;
                btn.innerHTML = `<span class="btn-spinner mr-2"></span> EXECUTING...`;
                resContainer.classList.remove('hidden');
                resDiv.innerHTML = `<div class="flex flex-col items-center justify-center py-10 text-slate-400"><div class="loader-ring !w-6 !h-6 !border-2 mb-3 !border-t-[#49cc90]"></div><p class="text-[9px] uppercase font-bold tracking-widest animate-pulse">Requesting...</p></div>`;
                
                const startTime = performance.now();
                
                try {
                    let fetchUrl = document.getElementById('m-url').value;
                    let options = { method: currentMethod };

                    if (currentMethod === 'POST') {
                        fetchUrl = window.location.origin + currentPath;
                        const bodyData = {};
                        if(currentAuth) bodyData.apikey = document.getElementById('in-apikey').value;
                        currentParams.forEach(p => {
                            const val = document.getElementById(`in-${p.name}`).value;
                            if(val) bodyData[p.name] = val;
                        });
                        options.headers = { 'Content-Type': 'application/json' };
                        options.body = JSON.stringify(bodyData);
                    }

                    const response = await fetch(fetchUrl, options);
                    const duration = (performance.now() - startTime).toFixed(0);
                    const contentType = response.headers.get("content-type");
                    
                    let statusColor = response.status >= 400 ? "text-red-400" : "text-[#49cc90]"; 
                    statsDiv.innerHTML = `<span class="flex items-center gap-1.5"><i class="fa-solid fa-circle text-[6px] ${statusColor}"></i> STATUS: ${response.status}</span><span class="flex items-center gap-1.5"><i class="fa-regular fa-clock text-[10px] text-indigo-400"></i> ${duration}ms</span>`;

                    if (contentType && contentType.includes("image")) {
                        const blob = await response.blob();
                        lastResponseType = 'image';
                        lastImageObjectURL = URL.createObjectURL(blob);
                        resDiv.innerHTML = `<img src="${lastImageObjectURL}" class="max-w-full h-auto rounded-lg mx-auto shadow-lg">`;
                        showToast("Gambar diterima!");
                    } else {
                        const data = await response.json();
                        lastResponseData = data;
                        lastResponseType = 'json';
                        resDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                        if (!response.ok) showToast("Error: " + response.status, "error");
                        else showToast("Berhasil!");
                    }
                } catch(e) { 
                    resDiv.innerHTML = `<span class="text-red-400 font-mono">Error: ${e.message}</span>`;
                    showToast("Gagal eksekusi", "error"); 
                } finally { 
                    btn.innerHTML = "Execute"; 
                    btn.disabled = false; 
                }
            };
        }

        function updateURL() {
            let q = new URLSearchParams();
            if(currentAuth) {
                const ak = document.getElementById('in-apikey')?.value;
                if(ak) q.append('apikey', ak);
            }
            currentParams.forEach(p => {
                const input = document.getElementById('in-'+p.name);
                const val = input ? input.value : "";
                if(val) q.append(p.name, val);
            });

            let finalURL = window.location.origin + currentPath;
            if (currentMethod === 'GET') {
                const qs = q.toString();
                if(qs) finalURL += '?' + qs;
            }
            document.getElementById('m-url').value = finalURL;
            generateSnippet();
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
        start();
    </script>
</body>
</html>
